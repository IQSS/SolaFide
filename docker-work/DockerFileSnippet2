FROM ubuntu:16.04
MAINTAINER Raman Prasad (raman_prasad@harvard.edu)

ENV DEBIAN_FRONTEND noninteractive

# For TwoRavens
RUN apt-get -y update && \
    apt-get install -y --no-install-recommends apt-utils

# ---------------------------------------------
# Install packages including git, apache2, and pip3
# ---------------------------------------------
RUN apt-get -y install vim && \
    apt-get -y install wget && \
    apt-get -y install net-tools && \

    apt-get -y install git && \
    apt-get -y install python3-pip && \
    pip3 install --upgrade pip

#    apt-get -y install libssl-dev && \
#    apt-get -y install libcurl4-openssl-dev && \

# ---------------------------------------------
# Clone the TwoRavens repository--the "rp-django" branch
# ---------------------------------------------
RUN mkdir /srv/webapps && \
    cd /srv/webapps && \
    git clone https://github.com/vjdorazio/TwoRavens.git && \
    cd TwoRavens && \
    git checkout rp-django

# ---------------------------------------------
# Virtualenv install
# ---------------------------------------------
RUN pip3 install virtualenvwrapper && \
    mkdir /root/virtualenvs && \
    cp /root/.bashrc /root/.bashrc-org && \
    echo 'export WORKON_HOME=/root/virtualenvs' >> /root/.bashrc && \
    echo 'export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3' >> /root/.bashrc && \
    source /usr/local/bin/virtualenvwrapper.sh && \
    source /root/.bashrc

# ---------------------------------------------
# Virtualenv creation
# ---------------------------------------------
RUN cd /srv/webapps/TwoRavens && \
    mkvirtualenv -p python3 2ravens && \
    pip install -r requirements/prod.txt && \
    echo 'export DJANGO_SETTINGS_MODULE=tworavensproject.settings.dev_container' >> /root/virtualenvs/2ravens/bin/postactivate && \
    source /root/virtualenvs/2ravens/bin/postactivate && \
    fab init_db


EXPOSE 8080



ENV DEBIAN_FRONTEND teletype
